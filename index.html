<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mini Minecraft</title>
<style>
  body { margin: 0; overflow: hidden; }
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- BASIC SETUP ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);

const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------- CONSTANTS ---------- */
const blockSize = 1;
const playerHeight = 2;

/* ---------- LIGHT ---------- */
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 0.5);
sun.position.set(10, 20, 10);
scene.add(sun);

/* ---------- PLAYER ---------- */
camera.position.set(0, 5 + playerHeight / 2, 5); // 5 blocks above ground
camera.rotation.order = "YXZ";

let velocityY = 0;
let canJump = false;

/* ---------- WORLD ---------- */
const world = [];
const blockGeo = new THREE.BoxGeometry(1, 1, 1);
const blockMat = new THREE.MeshStandardMaterial({ color: 0x55aa55 });

// Flat floor at y = 0
for (let x = -10; x <= 10; x++) {
  for (let z = -10; z <= 10; z++) {
    const block = new THREE.Mesh(blockGeo, blockMat);
    block.position.set(x, 0, z);
    scene.add(block);
    world.push(block);
  }
}

/* ---------- CONTROLS (MOBILE BUTTONS) ---------- */
const move = { f:0, b:0, l:0, r:0 };

function button(label, x, y, onDown, onUp){
  const b = document.createElement("button");
  b.textContent = label;
  b.style.position = "fixed";
  b.style.left = x;
  b.style.bottom = y;
  b.style.width = "60px";
  b.style.height = "60px";
  b.ontouchstart = onDown;
  b.ontouchend = onUp;
  document.body.appendChild(b);
}

button("↑","80px","120px",()=>move.f=1,()=>move.f=0);
button("↓","80px","20px",()=>move.b=1,()=>move.b=0);
button("←","20px","70px",()=>move.l=1,()=>move.l=0);
button("→","140px","70px",()=>move.r=1,()=>move.r=0);

/* ---------- GAME LOOP ---------- */
function animate(){
  requestAnimationFrame(animate);

  /* Movement */
  const speed = 0.08;
  const dx = (move.r - move.l) * speed;
  const dz = (move.b - move.f) * speed;
  camera.position.x += dx;
  camera.position.z += dz;

  /* Gravity */
  velocityY -= 0.02;
  camera.position.y += velocityY;

  /* Collision (THIS PART WORKS) */
  const playerBottom = camera.position.y - playerHeight / 2;
  canJump = false;

  for (const block of world) {
    const bx = block.position.x;
    const by = block.position.y;
    const bz = block.position.z;

    const onX = Math.abs(camera.position.x - bx) < 0.5;
    const onZ = Math.abs(camera.position.z - bz) < 0.5;
    const blockTop = by + 0.5;

    if (onX && onZ && velocityY <= 0) {
      if (playerBottom <= blockTop && playerBottom >= blockTop - 0.3) {
        camera.position.y = blockTop + playerHeight / 2;
        velocityY = 0;
        canJump = true;
      }
    }
  }

  renderer.render(scene, camera);
}

animate();
</script>

</body>
</html>
